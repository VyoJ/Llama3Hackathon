Title: Guidance Pydantic Program - LlamaIndex

URL Source: https://docs.llamaindex.ai/en/stable/examples/output_parsing/guidance_pydantic_program/

Markdown Content:
Guidance Pydantic Program - LlamaIndex


Generate structured data with [**guidance**](https://github.com/microsoft/guidance) via LlamaIndex.

With guidance, you can guarantee the output structure is correct by _forcing_ the LLM to output desired tokens.  
This is especialy helpful when you are using lower-capacity model (e.g. the current open source models), which otherwise would struggle to generate valid output that fits the desired output schema.

If you're opening this Notebook on colab, you will probably need to install LlamaIndex ðŸ¦™.

InÂ \[Â \]:

Copied!

%pip install llama\-index\-program\-guidance

%pip install llama-index-program-guidance

InÂ \[Â \]:

Copied!

!pip install llama\-index

!pip install llama-index

InÂ \[Â \]:

Copied!

from pydantic import BaseModel
from typing import List
from guidance.llms import OpenAI

from llama\_index.program.guidance import GuidancePydanticProgram

from pydantic import BaseModel from typing import List from guidance.llms import OpenAI from llama\_index.program.guidance import GuidancePydanticProgram

Define output schema

InÂ \[Â \]:

Copied!

class Song(BaseModel):
    title: str
    length\_seconds: int

class Album(BaseModel):
    name: str
    artist: str
    songs: List\[Song\]

class Song(BaseModel): title: str length\_seconds: int class Album(BaseModel): name: str artist: str songs: List\[Song\]

Define guidance pydantic program

InÂ \[Â \]:

Copied!

program \= GuidancePydanticProgram(
    output\_cls\=Album,
    prompt\_template\_str\=(
        "Generate an example album, with an artist and a list of songs. Using"
        " the movie {{movie\_name}} as inspiration"
    ),
    guidance\_llm\=OpenAI("text-davinci-003"),
    verbose\=True,
)

program = GuidancePydanticProgram( output\_cls=Album, prompt\_template\_str=( "Generate an example album, with an artist and a list of songs. Using" " the movie {{movie\_name}} as inspiration" ), guidance\_llm=OpenAI("text-davinci-003"), verbose=True, )

Run program to get structured output.  
Text highlighted in blue is variables specified by us, text highlighted in green is generated by the LLM.

InÂ \[Â \]:

Copied!

output \= program(movie\_name\="The Shining")

output = program(movie\_name="The Shining")

Stop program

Generate an example album, with an artist and a list of songs. Using the movie The Shining as inspiration
\`\`\`json
{
  "name": "The Shining",
  "artist": "Jack Torrance",
  "songs": \[{
  "title": "All Work and No Play",
  "length\_seconds": "180",
}, {
  "title": "The Overlook Hotel",
  "length\_seconds": "240",
}, {
  "title": "The Shining",
  "length\_seconds": "210",
}\],
}
\`\`\`

The output is a valid Pydantic object that we can then use to call functions/APIs.

InÂ \[Â \]:

Copied!

output

output

Out\[Â \]:

Album(name='The Shining', artist='Jack Torrance', songs=\[Song(title='All Work and No Play', length\_seconds=180), Song(title='The Overlook Hotel', length\_seconds=240), Song(title='The Shining', length\_seconds=210)\])

Back to top

[Previous Function Calling Program for Structured Extraction](https://docs.llamaindex.ai/en/stable/examples/output_parsing/function_program/)[Next Guidance for Sub-Question Query Engine](https://docs.llamaindex.ai/en/stable/examples/output_parsing/guidance_sub_question/)

Hi, how can I help you?

ðŸ¦™
